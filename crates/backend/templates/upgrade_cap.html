{% extends "base.html" %}
{% import "macros.html" as buttons %}

{% block title %}UpgradeCap: {{ short_id }}{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <div class="space-y-8">
        <div class="flex items-center gap-4">
             <h1 class="text-3xl font-bold font-heading">UpgradeCap: {{ short_id }}</h1>
             {{ buttons::copy_button(id) }}
        </div>

        <!-- Cards Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Overview Card -->
            <div class="bg-card border border-border rounded-xl p-8">
                <h2 class="text-xl font-bold font-heading mb-8">Overview</h2>
                <div class="space-y-6">
                    <div class="flex justify-between items-center bg-card/50">
                        <span class="text-muted-foreground font-medium">Package:</span>
                        <div class="flex items-center gap-2">
                            <a href="{{ package_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono text-sm truncate max-w-[200px]">{{ package }}</a>
                            {{ buttons::copy_button(package_full) }}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-muted-foreground font-medium">Owner:</span>
                        <div class="flex items-center gap-2">
                             <a href="{{ owner_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono text-sm truncate max-w-[200px]">{{ owner }}</a>
                             {{ buttons::copy_button(owner_full) }}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                         <span class="text-muted-foreground font-medium">Version:</span>
                        <span class="font-mono">{{ version }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                         <span class="text-muted-foreground font-medium">Policy:</span>
                        <span class="font-medium">{{ policy }}</span>
                    </div>
                </div>
            </div>

            <!-- More Info Card -->
            <div class="bg-card border border-border rounded-xl p-8 flex justify-between">
                <div>
                     <h2 class="text-xl font-bold font-heading mb-8">More Info</h2>
                     <div class="space-y-2">
                         <span class="text-muted-foreground font-medium block">Created By</span>
                         <div class="flex items-center gap-2 text-sm">
                             <a href="{{ created_by_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono">{{ created_by }}</a>
                             {{ buttons::copy_button(created_by_full) }}
                             <span class="text-muted-foreground">|</span>
                             <a href="{{ tx_digest_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono">{{ time_ago }}</a>
                         </div>
                     </div>
                </div>
            </div>
        </div>

        <!-- Tabs & Table Section -->
        <div x-data="{ tab: 'upgrades' }" class="space-y-6">
            <!-- Tab Buttons -->
            <div class="bg-card border border-border p-1 rounded-lg inline-flex">
                <button 
                    @click="tab = 'upgrades'"
                    :class="tab === 'upgrades' ? 'bg-primary text-white shadow-sm' : 'text-muted-foreground hover:text-foreground'"
                    class="px-6 py-2 rounded-md font-medium text-sm transition-all"
                    hx-get="/object/{{ id }}/versions"
                    hx-trigger="load, click"
                    hx-target="#table-body">
                    Upgrades
                </button>
                <button 
                    @click="tab = 'transfers'"
                    :class="tab === 'transfers' ? 'bg-primary text-white shadow-sm' : 'text-muted-foreground hover:text-foreground'"
                    class="px-6 py-2 rounded-md font-medium text-sm transition-all"
                    hx-get="/object/{{ id }}/transfers"
                    hx-target="#table-body">
                    Transfers
                </button>
            </div>

            <!-- Table Card -->
             <div class="bg-card border border-border rounded-xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <!-- Upgrades Header -->
                        <thead x-show="tab === 'upgrades'" class="bg-muted/30 text-white font-medium border-b border-border">
                            <tr>
                                <th class="py-4 px-6">Version</th>
                                <th class="py-4 px-6">Package ID</th>
                                <th class="py-4 px-6">Tx Digest</th>
                                <th class="py-4 px-6">Checkpoint</th>
                                <th class="py-4 px-6">Age</th>
                            </tr>
                        </thead>
                        <!-- Transfers Header -->
                        <thead x-show="tab === 'transfers'" class="bg-muted/30 text-white font-medium border-b border-border" style="display: none;">
                            <tr>
                                <th class="py-4 px-6">Tx Digest</th>
                                <th class="py-4 px-6">Checkpoint</th>
                                <th class="py-4 px-6">Age</th>
                                <th class="py-4 px-6">From</th>
                                <th class="py-4 px-6">To</th>
                            </tr>
                        </thead>
                        
                        <!-- Table Body (Target for HTMX) -->
                        <tbody id="table-body" class="divide-y divide-border"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}