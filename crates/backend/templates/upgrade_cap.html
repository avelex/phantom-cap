{% extends "base.html" %}

{% block title %}UpgradeCap: {{ short_id }}{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <div class="space-y-8">
        <div class="flex items-center gap-4">
             <h1 class="text-3xl font-bold font-heading">{{ short_id }}</h1>
             <button class="text-muted-foreground hover:text-primary transition-colors" onclick="navigator.clipboard.writeText('{{ id }}')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
            </button>
        </div>

        <!-- Cards Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Overview Card -->
            <div class="bg-card border border-border rounded-xl p-8">
                <h2 class="text-xl font-bold font-heading mb-8">Overview</h2>
                <div class="space-y-6">
                    <div class="flex justify-between items-center bg-card/50">
                        <span class="text-muted-foreground font-medium">Package:</span>
                        <div class="flex items-center gap-2">
                            <a href="{{ package_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono text-sm truncate max-w-[200px]">{{ package }}</a>
                            <button class="text-muted-foreground hover:text-primary transition-colors" onclick="navigator.clipboard.writeText('{{ package_full }}')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-muted-foreground font-medium">Owner:</span>
                        <div class="flex items-center gap-2">
                             <a href="{{ owner_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono text-sm truncate max-w-[200px]">{{ owner }}</a>
                             <button class="text-muted-foreground hover:text-primary transition-colors" onclick="navigator.clipboard.writeText('{{ owner_full }}')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                             </button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                         <span class="text-muted-foreground font-medium">Version:</span>
                        <span class="font-mono">{{ version }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                         <span class="text-muted-foreground font-medium">Policy:</span>
                        <span class="font-medium">{{ policy }}</span>
                    </div>
                </div>
            </div>

            <!-- More Info Card -->
            <div class="bg-card border border-border rounded-xl p-8 flex justify-between">
                <div>
                     <h2 class="text-xl font-bold font-heading mb-8">More Info</h2>
                     <div class="space-y-2">
                         <span class="text-muted-foreground font-medium block">Created By</span>
                         <div class="flex items-center gap-2 text-sm">
                             <a href="{{ created_by_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono">{{ created_by }}</a>
                             <button class="text-muted-foreground hover:text-primary transition-colors" onclick="navigator.clipboard.writeText('{{ created_by_full }}')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                             </button>
                             <span class="text-muted-foreground">|</span>
                             <a href="{{ tx_digest_url }}" class="text-primary hover:text-primary/80 transition-colors font-mono">{{ time_ago }}</a>
                         </div>
                     </div>
                </div>
            </div>
        </div>

        <!-- Tabs & Table Section -->
        <div x-data="{ tab: 'upgrades' }" class="space-y-6">
            <!-- Tab Buttons -->
            <div class="bg-card border border-border p-1 rounded-lg inline-flex">
                <button 
                    @click="tab = 'upgrades'"
                    :class="tab === 'upgrades' ? 'bg-primary text-white shadow-sm' : 'text-muted-foreground hover:text-foreground'"
                    class="px-6 py-2 rounded-md font-medium text-sm transition-all"
                    hx-get="/cap/{{ id }}/versions"
                    hx-trigger="load, click"
                    hx-target="#table-body">
                    Upgrades
                </button>
                <button 
                    @click="tab = 'transfers'"
                    :class="tab === 'transfers' ? 'bg-primary text-white shadow-sm' : 'text-muted-foreground hover:text-foreground'"
                    class="px-6 py-2 rounded-md font-medium text-sm transition-all"
                    hx-get="/cap/{{ id }}/transfers"
                    hx-target="#table-body">
                    Transfers
                </button>
            </div>

            <!-- Table Card -->
             <div class="bg-card border border-border rounded-xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <!-- Upgrades Header -->
                        <thead x-show="tab === 'upgrades'" class="bg-muted/30 text-white font-medium border-b border-border">
                            <tr>
                                <th class="py-4 px-6">Version</th>
                                <th class="py-4 px-6">Package ID</th>
                                <th class="py-4 px-6">Tx Digest</th>
                                <th class="py-4 px-6">Checkpoint</th>
                                <th class="py-4 px-6">Age</th>
                            </tr>
                        </thead>
                        <!-- Transfers Header -->
                        <thead x-show="tab === 'transfers'" class="bg-muted/30 text-white font-medium border-b border-border" style="display: none;">
                            <tr>
                                <th class="py-4 px-6">Tx Digest</th>
                                <th class="py-4 px-6">Checkpoint</th>
                                <th class="py-4 px-6">Age</th>
                                <th class="py-4 px-6">From</th>
                                <th class="py-4 px-6">To</th>
                            </tr>
                        </thead>
                        
                        <!-- Table Body (Target for HTMX) -->
                        <tbody id="table-body" class="divide-y divide-border"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}